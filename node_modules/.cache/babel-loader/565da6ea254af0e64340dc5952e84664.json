{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Acer/Desktop/money-assignment/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Acer/Desktop/money-assignment/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Acer/Desktop/money-assignment/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{Button,Modal}from'react-bootstrap';import Container from'react-bootstrap/Container';import Table from'react-bootstrap/Table';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import Select from'react-select';import{format}from'date-fns';import{BsPlus,BsTrash,BsPencil}from\"react-icons/bs\";import{useForm}from\"react-hook-form\";import config from'./config';import TextField from'@material-ui/core/TextField';import{useCollectionData}from'react-firebase-hooks/firestore';import firebase from'firebase/app';import'firebase/firestore';import'firebase/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";if(firebase.apps.length===0){firebase.initializeApp(config);}var firestore=firebase.firestore();export default function Journal(){var moneyRef=firestore.collection('money');var categoryRef=firestore.collection('category');var query=moneyRef.orderBy('createdAt','asc').limitToLast(100);var categoryQuery=categoryRef.orderBy('createdAt','asc').limitToLast(100);var _useCollectionData=useCollectionData(query,{idField:'id'}),_useCollectionData2=_slicedToArray(_useCollectionData,1),data=_useCollectionData2[0];var _useCollectionData3=useCollectionData(categoryQuery,{idField:'id'}),_useCollectionData4=_slicedToArray(_useCollectionData3,1),categories=_useCollectionData4[0];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),categoryOption=_useState2[0],setCategoryOption=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),category=_useState4[0],setCategory=_useState4[1];var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit;var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showForm=_useState6[0],setShowForm=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),records=_useState8[0],setRecords=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),total=_useState10[0],setTotal=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),editMode=_useState12[0],setEditMode=_useState12[1];var _useState13=useState({id:null,createdAt:new Date(),description:'',amount:0,category:categoryOption[0]}),_useState14=_slicedToArray(_useState13,2),tempData=_useState14[0],setTempData=_useState14[1];useEffect(function(){if(categories){// Guard condition\nvar tempCategories=[{id:0,name:'-- All -- '}];categories.forEach(function(x){tempCategories.push({id:x.id,name:x.name});});setCategoryOption(tempCategories);}},[categories]);useEffect(function(){if(data){var t=0;var r=data.map(function(d,i){t+=d.amount;return/*#__PURE__*/_jsx(JournalRow,{data:d,i:i,onDeleteClick:handleDeleteClick,onEditClick:handleEditClick},i);});setRecords(r);setTotal(t);}},[data]);var handleCategoryFilterChange=function handleCategoryFilterChange(obj){if(data){var t=0;var filteredData=data.filter(function(d){return obj.id==0||d.category.id==obj.id;});var r=filteredData.map(function(d,i){t+=d.amount;return/*#__PURE__*/_jsx(JournalRow,{data:d,i:i,onDeleteClick:handleDeleteClick,onEditClick:handleEditClick});});setRecords(r);setTotal(t);}};var handleshowForm=function handleshowForm(){return setShowForm(true);};var handleCloseForm=function handleCloseForm(){setTempData({id:null,createdAt:new Date(),description:'',amount:0,category:categoryOption[0]});setEditMode(false);setCategory({});setShowForm(false);};var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var preparedData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:preparedData={description:data.description,amount:parseFloat(data.amount),createdAt:new Date(data.createdAt),category:category};if(!editMode){_context.next=6;break;}_context.next=4;return moneyRef.doc(data.id).set(preparedData).then(function(){return console.log(\"moneyRef has been set\");}).catch(function(error){console.error(\"Error: \",error);alert(error);});case 4:_context.next=8;break;case 6:_context.next=8;return moneyRef.add(preparedData).then(function(){return console.log(\"New record has been added.\");}).catch(function(error){console.error(\"Errror:\",error);alert(error);});case 8:handleCloseForm();case 9:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x){return _ref.apply(this,arguments);};}();var handleCategoryChange=function handleCategoryChange(obj){setCategory(obj);};var handleDeleteClick=function handleDeleteClick(id){if(window.confirm(\"Are you sure to delete this record?\"))moneyRef.doc(id).delete();};var handleEditClick=function handleEditClick(data){var preparedData={id:data.id,description:data.description,amount:parseFloat(data.amount),createdAt:data.createdAt.toDate(),category:category};setEditMode(true);setTempData(preparedData);setCategory(data.category);setShowForm(true);};return/*#__PURE__*/_jsx(\"div\",{style:{\"marginTop\":1+'%'},children:/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Journal\"}),/*#__PURE__*/_jsxs(Button,{variant:\"outline-dark\",onClick:handleshowForm,children:[/*#__PURE__*/_jsx(BsPlus,{}),\" Add\"]})]}),/*#__PURE__*/_jsxs(Col,{children:[\"Category:\",/*#__PURE__*/_jsx(Select,{options:categoryOption,getOptionLabel:function getOptionLabel(x){return x.name;},getOptionValue:function getOptionValue(x){return x.id;},onChange:handleCategoryFilterChange})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{\"marginTop\":3+'%'},children:/*#__PURE__*/_jsxs(Table,{striped:true,hover:true,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Category\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Amount\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:records}),/*#__PURE__*/_jsx(\"tfooter\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:5,children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"Total: \",total]})})})]})}),/*#__PURE__*/_jsx(Modal,{show:showForm,onHide:handleCloseForm,\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",placeholder:\"ID\",ref:register({required:false}),name:\"id\",id:\"id\",defaultValue:tempData.id}),/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:editMode?\"Edit Record\":\"Add New Record\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"createdAt\",children:\"Date\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"Date\",ref:register({required:true}),name:\"createdAt\",id:\"createdAt\",defaultValue:format(tempData.createdAt,\"yyyy-MM-dd\")})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category\",children:\"Category\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Select,{id:\"category\",name:\"category\",value:category,placeholder:\"Category\",options:categoryOption.filter(function(c){return c.id!=0;}),onChange:handleCategoryChange,getOptionLabel:function getOptionLabel(x){return x.name;},getOptionValue:function getOptionValue(x){return x.id;},ref:register})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",children:\"Description\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(TextField,{id:\"standard-basic\",label:\"Standard\",inputRef:register({required:true}),name:\"description\"})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"amount\",children:\"Amount\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"any\",min:\"0\",placeholder:\"Amount\",ref:register({required:true}),name:\"amount\",id:\"amount\",defaultValue:tempData.amount})})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleCloseForm,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{onClick:onModalFormSubmit(editMode,handleSubmit,onSubmit),variant:editMode?\"success\":\"primary\",type:\"submit\",children:editMode?\"Save Record\":\"Add Record\"})]})]})})]})});}function onModalFormSubmit(editMode,handleSubmit,onSubmit){console.log(\"modal click\",\"modal clicked\");console.log(editMode.toString(),editMode.toString());handleSubmit(onSubmit);}function JournalRow(props){var d=props.data;var i=props.i;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(BsTrash,{onClick:function onClick(){return props.onDeleteClick(d.id);}}),/*#__PURE__*/_jsx(BsPencil,{onClick:function onClick(){return props.onEditClick(d);}})]}),/*#__PURE__*/_jsx(\"td\",{children:format(d.createdAt.toDate(),\"yyyy-MM-dd\")}),/*#__PURE__*/_jsx(\"td\",{children:d.description}),/*#__PURE__*/_jsx(\"td\",{children:d.category.name}),/*#__PURE__*/_jsx(\"td\",{children:d.amount})]});}","map":{"version":3,"sources":["C:/Users/Acer/Desktop/money-assignment/src/Journal.js"],"names":["useState","useEffect","Button","Modal","Container","Table","Row","Col","Select","format","BsPlus","BsTrash","BsPencil","useForm","config","TextField","useCollectionData","firebase","apps","length","initializeApp","firestore","Journal","moneyRef","collection","categoryRef","query","orderBy","limitToLast","categoryQuery","idField","data","categories","categoryOption","setCategoryOption","category","setCategory","register","handleSubmit","showForm","setShowForm","records","setRecords","total","setTotal","editMode","setEditMode","id","createdAt","Date","description","amount","tempData","setTempData","tempCategories","name","forEach","x","push","t","r","map","d","i","handleDeleteClick","handleEditClick","handleCategoryFilterChange","obj","filteredData","filter","handleshowForm","handleCloseForm","onSubmit","preparedData","parseFloat","doc","set","then","console","log","catch","error","alert","add","handleCategoryChange","window","confirm","delete","toDate","required","c","onModalFormSubmit","toString","JournalRow","props","onDeleteClick","onEditClick"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\r\nimport { Button, Modal } from 'react-bootstrap'\r\nimport Container from 'react-bootstrap/Container'\r\nimport Table from 'react-bootstrap/Table'\r\nimport Row from 'react-bootstrap/Row'\r\nimport Col from 'react-bootstrap/Col'\r\nimport Select from 'react-select'\r\nimport { format } from 'date-fns'\r\nimport { BsPlus, BsTrash, BsPencil } from \"react-icons/bs\";\r\nimport { useForm } from \"react-hook-form\"\r\nimport config from './config';\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore'\r\nimport 'firebase/auth'\r\n\r\nif (firebase.apps.length === 0) {\r\n    firebase.initializeApp(config);\r\n}\r\nconst firestore = firebase.firestore()\r\n\r\nexport default function Journal() {\r\n    const moneyRef = firestore.collection('money');\r\n    const categoryRef = firestore.collection('category');\r\n    const query = moneyRef.orderBy('createdAt', 'asc').limitToLast(100);\r\n\r\n    const categoryQuery = categoryRef.orderBy('createdAt', 'asc').limitToLast(100);\r\n    const [data] = useCollectionData(query, { idField: 'id' });\r\n    const [categories] = useCollectionData(categoryQuery, { idField: 'id' });\r\n\r\n    const [categoryOption, setCategoryOption] = useState([]);\r\n    const [category, setCategory] = useState()\r\n    const { register, handleSubmit } = useForm()\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [records, setRecords] = useState([])\r\n    const [total, setTotal] = useState(0)\r\n    const [editMode, setEditMode] = useState(false)\r\n    const [tempData, setTempData] = useState({\r\n        id: null,\r\n        createdAt: new Date(),\r\n        description: '',\r\n        amount: 0,\r\n        category: categoryOption[0]\r\n    })\r\n\r\n    useEffect(() => {\r\n        if (categories) { // Guard condition\r\n            const tempCategories = [{ id: 0, name: '-- All -- ' }];\r\n            categories.forEach((x) => {\r\n                tempCategories.push({ id: x.id, name: x.name });\r\n            })\r\n            setCategoryOption(tempCategories);\r\n        }\r\n    }, [categories])\r\n\r\n    useEffect(() => {\r\n        if (data) {\r\n            let t = 0\r\n            let r = data.map((d, i) => {\r\n                t += d.amount\r\n                return (\r\n                    <JournalRow\r\n                        data={d}\r\n                        i={i}\r\n                        key={i}\r\n                        onDeleteClick={handleDeleteClick}\r\n                        onEditClick={handleEditClick}\r\n                    />\r\n                )\r\n            })\r\n\r\n            setRecords(r)\r\n            setTotal(t)\r\n        }\r\n    }, [data])\r\n\r\n    const handleCategoryFilterChange = (obj) => {\r\n        if (data) {\r\n            let t = 0\r\n            let filteredData = data.filter(d => obj.id == 0 || d.category.id == obj.id)\r\n            let r = filteredData.map((d, i) => {\r\n                t += d.amount\r\n                return (\r\n                    <JournalRow data={d} i={i} onDeleteClick={handleDeleteClick}\r\n                        onEditClick={handleEditClick} />\r\n                )\r\n            })\r\n\r\n            setRecords(r)\r\n            setTotal(t)\r\n        }\r\n    }\r\n\r\n    const handleshowForm = () => setShowForm(true)\r\n\r\n    const handleCloseForm = () => {\r\n        setTempData({\r\n            id: null,\r\n            createdAt: new Date(),\r\n            description: '',\r\n            amount: 0,\r\n            category: categoryOption[0]\r\n        })\r\n        setEditMode(false)\r\n        setCategory({})\r\n        setShowForm(false)\r\n    }\r\n\r\n    const onSubmit = async (data) => {\r\n        let preparedData = {\r\n            description: data.description,\r\n            amount: parseFloat(data.amount),\r\n            createdAt: new Date(data.createdAt),\r\n            category: category\r\n        }\r\n        if (editMode) {\r\n            await moneyRef.doc(data.id)\r\n                .set(preparedData)\r\n                .then(() => console.log(\"moneyRef has been set\"))\r\n                .catch((error) => {\r\n                    console.error(\"Error: \", error);\r\n                    alert(error)\r\n                });\r\n        } else {\r\n            await moneyRef\r\n                .add(preparedData)\r\n                .then(() => console.log(\"New record has been added.\"))\r\n                .catch((error) => {\r\n                    console.error(\"Errror:\", error)\r\n                    alert(error)\r\n                })\r\n        }\r\n        handleCloseForm()\r\n    }\r\n\r\n    const handleCategoryChange = (obj) => {\r\n        setCategory(obj)\r\n    }\r\n\r\n    const handleDeleteClick = (id) => {\r\n        if (window.confirm(\"Are you sure to delete this record?\"))\r\n            moneyRef.doc(id).delete()\r\n    }\r\n\r\n    const handleEditClick = (data) => {\r\n        let preparedData = {\r\n            id: data.id,\r\n            description: data.description,\r\n            amount: parseFloat(data.amount),\r\n            createdAt: data.createdAt.toDate(),\r\n            category: category\r\n        }\r\n        setEditMode(true)\r\n        setTempData(preparedData)\r\n        setCategory(data.category)\r\n        setShowForm(true)\r\n    }\r\n\r\n    return (\r\n        <div style={{\"marginTop\": 1 + '%'}}>\r\n            <Container>\r\n                <Row>\r\n                    <Col>\r\n                        <h1>Journal</h1>\r\n                        <Button variant=\"outline-dark\" onClick={handleshowForm}>\r\n                            <BsPlus /> Add\r\n                    </Button>\r\n                    </Col>\r\n                    <Col>\r\n                        Category:\r\n          <Select\r\n                            options={categoryOption}\r\n                            getOptionLabel={x => x.name}\r\n                            getOptionValue={x => x.id}\r\n                            onChange={handleCategoryFilterChange}\r\n                        />\r\n                    </Col>\r\n\r\n                </Row>\r\n                <div style={{\"marginTop\": 3 + '%'}}>\r\n                <Table striped hover>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>#</th>\r\n                            <th>Date</th>\r\n                            <th>Description</th>\r\n                            <th>Category</th>\r\n                            <th>Amount</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {records}\r\n                    </tbody>\r\n                    <tfooter>\r\n                        <td colSpan={5}>\r\n                            <h3>Total: {total}</h3>\r\n                        </td>\r\n                    </tfooter>\r\n                </Table>\r\n                </div>\r\n\r\n                <Modal\r\n                    show={showForm} onHide={handleCloseForm}\r\n                    aria-labelledby=\"contained-modal-title-vcenter\"\r\n                    centered>\r\n                    <form onSubmit={handleSubmit(onSubmit)}>\r\n                        <input\r\n                            type=\"hidden\"\r\n                            placeholder=\"ID\"\r\n                            ref={register({ required: false })}\r\n                            name=\"id\"\r\n                            id=\"id\"\r\n                            defaultValue={tempData.id}\r\n                        />\r\n                        <Modal.Header closeButton>\r\n                            <Modal.Title>\r\n                                {editMode ? \"Edit Record\" : \"Add New Record\"}\r\n                            </Modal.Title>\r\n                        </Modal.Header>\r\n                        <Modal.Body>\r\n                            <Row>\r\n                                <Col>\r\n                                    <label htmlFor=\"createdAt\">Date</label>\r\n                                </Col>\r\n                                <Col>\r\n                                    <input\r\n                                        type=\"date\"\r\n                                        placeholder=\"Date\"\r\n                                        ref={register({ required: true })}\r\n                                        name=\"createdAt\"\r\n                                        id=\"createdAt\"\r\n                                        defaultValue={format(tempData.createdAt, \"yyyy-MM-dd\")}\r\n                                    />\r\n\r\n                                </Col>\r\n                            </Row>\r\n\r\n                            <Row>\r\n                                <Col>\r\n                                    <label htmlFor=\"category\">Category</label>\r\n                                </Col>\r\n                                <Col>\r\n                                    <Select\r\n                                        id=\"category\"\r\n                                        name=\"category\"\r\n                                        value={category}\r\n                                        placeholder=\"Category\"\r\n                                        options={categoryOption.filter(c => c.id != 0)}\r\n                                        onChange={handleCategoryChange}\r\n                                        getOptionLabel={x => x.name}\r\n                                        getOptionValue={x => x.id}\r\n                                        ref={register}\r\n                                    />\r\n                                </Col>\r\n                            </Row>\r\n\r\n                            <Row>\r\n                                <Col>\r\n                                    <label htmlFor=\"description\">Description</label>\r\n                                </Col>\r\n                                <Col>\r\n                                    {/* <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Description\"\r\n                                        ref={register({ required: true })}\r\n                                        name=\"description\"\r\n                                        id=\"description\"\r\n                                        defaultValue={tempData.description}\r\n                                    /> */}\r\n                                    <TextField id=\"standard-basic\" label=\"Standard\" inputRef={register({ required: true })} name=\"description\" />\r\n                                </Col>\r\n                            </Row>\r\n                            <Row>\r\n                                <Col>\r\n                                    <label htmlFor=\"amount\">Amount</label>\r\n                                </Col>\r\n                                <Col>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        step=\"any\"\r\n                                        min=\"0\"\r\n                                        placeholder=\"Amount\"\r\n                                        ref={register({ required: true })}\r\n                                        name=\"amount\"\r\n                                        id=\"amount\"\r\n                                        defaultValue={tempData.amount}\r\n                                    />\r\n                                </Col>\r\n                            </Row>\r\n                        </Modal.Body>\r\n                        <Modal.Footer>\r\n                            <Button variant=\"secondary\" onClick={handleCloseForm}>\r\n                                Close\r\n                        </Button>\r\n                            <Button onClick={onModalFormSubmit(editMode, handleSubmit, onSubmit)} variant={editMode ? \"success\" : \"primary\"} type=\"submit\">\r\n                                {editMode ? \"Save Record\" : \"Add Record\"}\r\n                            </Button>\r\n                        </Modal.Footer>\r\n                    </form>\r\n                </Modal>\r\n            </Container>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction onModalFormSubmit(editMode, handleSubmit, onSubmit) {\r\n    console.log(\"modal click\", \"modal clicked\")\r\n    console.log(editMode.toString(), editMode.toString())\r\n    handleSubmit(onSubmit)\r\n}\r\n\r\nfunction JournalRow(props) {\r\n    let d = props.data\r\n    let i = props.i\r\n    return (\r\n        <tr>\r\n            <td>\r\n                <BsTrash onClick={() => props.onDeleteClick(d.id)} />\r\n                <BsPencil onClick={() => props.onEditClick(d)} />\r\n            </td>\r\n            <td>{format(d.createdAt.toDate(), \"yyyy-MM-dd\")}</td>\r\n            <td>{d.description}</td>\r\n            <td>{d.category.name}</td>\r\n            <td>{d.amount}</td>\r\n        </tr>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}