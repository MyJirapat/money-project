{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Acer/Desktop/money-assignment/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Acer/Desktop/money-assignment/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Acer/Desktop/money-assignment/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{useState,useEffect}from'react';import{useCollectionData}from'react-firebase-hooks/firestore';import{FormText,Table,Modal,Button,Container,Row,Col}from'react-bootstrap';import{useForm}from\"react-hook-form\";import config from'./config';import{format}from'date-fns';import{BsPlus,BsTrash,BsPencil}from\"react-icons/bs\";import firebase from'firebase/app';import'firebase/firestore';import'firebase/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";if(firebase.apps.length===0){firebase.initializeApp(config);}var firestore=firebase.firestore();var categoryRef=firestore.collection('category');var journalRef=firestore.collection('money');export default function Category(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),categoryState=_useState2[0],setCategoryState=_useState2[1];var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit;var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showForm=_useState4[0],setShowForm=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),editMode=_useState6[0],setEditMode=_useState6[1];var _useState7=useState({id:null,createdAt:new Date(),description:'',name:''}),_useState8=_slicedToArray(_useState7,2),tempData=_useState8[0],setTempData=_useState8[1];var query=categoryRef.orderBy('createdAt','asc').limitToLast(100);var _useCollectionData=useCollectionData(query,{idField:'id'}),_useCollectionData2=_slicedToArray(_useCollectionData,1),data=_useCollectionData2[0];var journalQuery=journalRef.orderBy('createdAt','asc');var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isDeleted=_useState10[0],setIsDeleted=_useState10[1];var _useCollectionData3=useCollectionData(journalQuery,{idField:'id'}),_useCollectionData4=_slicedToArray(_useCollectionData3,1),journalDatas=_useCollectionData4[0];console.log(journalDatas);useEffect(function(){if(data){var mappedRowData=data.map(function(queryData,index){console.log(journalDatas);return/*#__PURE__*/_jsx(CategoryTableRow,{data:queryData,id:data[index].id,list:data[index],onDeleteClicked:onItemDeleteListener,onEditClick:handleEditClick},data[index].id);});setCategoryState(mappedRowData);}},[data,journalDatas]);var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data,e){var preparedData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:preparedData={description:data.description,name:data.name,createdAt:new Date()};if(isDeleted){}if(!editMode){_context2.next=10;break;}console.log('sss',JSON.stringify(journalDatas));console.log(data.id);if(journalDatas){console.log('what?');console.log('id',data.id);journalDatas.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(x){var temp;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('cate',x.category.id);if(!(x.category.id===data.id)){_context.next=7;break;}temp=x;console.log('ss',temp);temp.category.name=data.name;_context.next=7;return journalRef.doc(x.id).set(temp).then(function(){return console.log(\"moneyRef has been set\");}).catch(function(error){console.error(\"Error: \",error);alert(error);});case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref2.apply(this,arguments);};}());}_context2.next=8;return categoryRef.doc(data.id).set(preparedData).then(function(){return console.log(\"moneyRef has been set\");}).catch(function(error){console.error(\"Error: \",error);alert(error);});case 8:_context2.next=12;break;case 10:_context2.next=12;return categoryRef.add(preparedData).then(function(){return console.log(\"New record has been added.\");}).catch(function(error){console.error(\"Errror:\",error);alert(error);});case 12:handleCloseForm();case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function onSubmit(_x,_x2){return _ref.apply(this,arguments);};}();var onItemDeleteListener=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id,list,journals){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!window.confirm(\"Are you sure?\")){_context4.next=4;break;}if(journalDatas){journalDatas.forEach(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(x){var temp2;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log('data id',list.id);console.log('cate id',x.category.id);if(!(x.category.id===list.id)){_context3.next=9;break;}temp2=x;console.log('journalRef',journalRef);temp2.category.id=\"unknown\";temp2.category.name=\"Uncategorised\";_context3.next=9;return journalRef.doc(x.id).set(temp2).then(function(){return console.log(\"moneyRef has been set\");}).catch(function(error){console.error(\"Error: \",error);alert(error);});case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x7){return _ref4.apply(this,arguments);};}());}_context4.next=4;return categoryRef.doc(id).delete();case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function onItemDeleteListener(_x4,_x5,_x6){return _ref3.apply(this,arguments);};}();var handleEditClick=function handleEditClick(id,list){var preparedData={id:id,description:list.description,name:list.name,createdAt:new Date(list.createdAt.seconds)};console.log(\"handleEditClick\",preparedData);setTempData(preparedData);setEditMode(true);setShowForm(true);};var handleshowForm=function handleshowForm(){return setShowForm(true);};var handleCloseForm=function handleCloseForm(){setShowForm(false);};return/*#__PURE__*/_jsx(\"div\",{style:{\"marginTop\":1+'%'},children:/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Category Management\"}),/*#__PURE__*/_jsxs(Button,{variant:\"outline-dark\",onClick:handleshowForm,children:[/*#__PURE__*/_jsx(BsPlus,{}),\" Add\"]})]})}),/*#__PURE__*/_jsx(\"div\",{style:{\"marginTop\":3+'%'},children:/*#__PURE__*/_jsxs(Table,{stickyheader:\"true\",\"aria-label\":\"sticky table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Description\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:categoryState})]})}),/*#__PURE__*/_jsx(Modal,{show:showForm,onHide:handleCloseForm,\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",placeholder:\"createdAt\",ref:register({required:false}),name:\"id\",id:\"id\",defaultValue:format(tempData.createdAt,\"yyyy-MM-dd\")}),/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",placeholder:\"ID\",ref:register({required:false}),name:\"id\",id:\"id\",defaultValue:tempData.id}),/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:editMode?\"Edit Category\":\"Add New Category\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"name\",children:\"Name\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Name\",ref:register({required:true}),name:\"name\",id:\"name\",defaultValue:tempData.name})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{htmlFor:\"name\",children:\"Description\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Description\",ref:register({required:true}),name:\"description\",id:\"description\",defaultValue:tempData.description})})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleCloseForm,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:editMode?\"success\":\"primary\",type:\"submit\",children:editMode?\"Save Category\":\"Add Category\"})]})]})})]})});}function CategoryTableRow(props){var data=props.data;var id=props.id;var list=props.list;console.log(\"props \".concat(data));return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(BsTrash,{onClick:function onClick(){return props.onDeleteClicked(id,list);}}),/*#__PURE__*/_jsx(BsPencil,{onClick:function onClick(){return props.onEditClick(id,list);}})]}),/*#__PURE__*/_jsx(\"td\",{children:data.name}),/*#__PURE__*/_jsx(\"td\",{children:data.description})]});}","map":{"version":3,"sources":["C:/Users/Acer/Desktop/money-assignment/src/Category.js"],"names":["React","useState","useEffect","useCollectionData","FormText","Table","Modal","Button","Container","Row","Col","useForm","config","format","BsPlus","BsTrash","BsPencil","firebase","apps","length","initializeApp","firestore","categoryRef","collection","journalRef","Category","categoryState","setCategoryState","register","handleSubmit","showForm","setShowForm","editMode","setEditMode","id","createdAt","Date","description","name","tempData","setTempData","query","orderBy","limitToLast","idField","data","journalQuery","isDeleted","setIsDeleted","journalDatas","console","log","mappedRowData","map","queryData","index","onItemDeleteListener","handleEditClick","onSubmit","e","preparedData","JSON","stringify","forEach","x","category","temp","doc","set","then","catch","error","alert","add","handleCloseForm","list","journals","window","confirm","temp2","delete","seconds","handleshowForm","required","CategoryTableRow","props","onDeleteClicked","onEditClick"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { useState, useEffect } from 'react'\r\nimport { useCollectionData } from 'react-firebase-hooks/firestore'\r\nimport { FormText, Table, Modal, Button, Container, Row, Col } from 'react-bootstrap';\r\nimport { useForm } from \"react-hook-form\"\r\nimport config from './config';\r\nimport { format } from 'date-fns'\r\nimport { BsPlus, BsTrash, BsPencil } from \"react-icons/bs\"\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore'\r\nimport 'firebase/auth'\r\n\r\nif (firebase.apps.length === 0) {\r\n    firebase.initializeApp(config);\r\n}\r\n\r\nconst firestore = firebase.firestore()\r\nconst categoryRef = firestore.collection('category')\r\nconst journalRef = firestore.collection('money')\r\n\r\nexport default function Category() {\r\n    const [categoryState, setCategoryState] = useState([])\r\n\r\n    const { register, handleSubmit } = useForm()\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editMode, setEditMode] = useState(false)\r\n    const [tempData, setTempData] = useState({\r\n        id: null,\r\n        createdAt: new Date(),\r\n        description: '',\r\n        name: ''\r\n    })\r\n\r\n    const query = categoryRef.orderBy('createdAt', 'asc').limitToLast(100)\r\n    const [data] = useCollectionData(query, { idField: 'id' })\r\n\r\n    const journalQuery = journalRef.orderBy('createdAt', 'asc')\r\n    var [isDeleted, setIsDeleted] = useState(false);\r\n    const [journalDatas] = useCollectionData(journalQuery, { idField: 'id' })\r\n\r\n    console.log(journalDatas);\r\n\r\n    useEffect(() => {\r\n        if (data) {\r\n            let mappedRowData = data.map((queryData, index) => {\r\n                console.log(journalDatas);\r\n                return (\r\n                    <CategoryTableRow\r\n                        data={queryData}\r\n                        key={data[index].id}\r\n                        id={data[index].id}\r\n                        list={data[index]}\r\n                        onDeleteClicked={onItemDeleteListener}\r\n                        onEditClick={handleEditClick}\r\n                    />\r\n                )\r\n            })\r\n            setCategoryState(mappedRowData)\r\n        }\r\n    }, [data, journalDatas])\r\n\r\n    const onSubmit = async (data, e) => {\r\n        let preparedData = {\r\n            description: data.description,\r\n            name: data.name,\r\n            createdAt: new Date()\r\n        }\r\n        if (isDeleted) {\r\n        }\r\n\r\n        if (editMode) {\r\n            console.log('sss', JSON.stringify(journalDatas))\r\n            console.log(data.id);\r\n\r\n            if (journalDatas) {\r\n                console.log('what?');\r\n                console.log('id', data.id);\r\n\r\n                journalDatas.forEach(async (x) => {\r\n                    console.log('cate', x.category.id)\r\n                    if (x.category.id === data.id) {\r\n                        const temp = x;\r\n                        console.log('ss', temp);\r\n                        temp.category.name = data.name;\r\n                        await journalRef.doc(x.id)\r\n                            .set(temp)\r\n                            .then(() => console.log(\"moneyRef has been set\"))\r\n                            .catch((error) => {\r\n                                console.error(\"Error: \", error);\r\n                                alert(error)\r\n                            });\r\n                    }\r\n                })\r\n            }\r\n\r\n            await categoryRef.doc(data.id)\r\n                .set(preparedData)\r\n                .then(() => console.log(\"moneyRef has been set\"))\r\n                .catch((error) => {\r\n                    console.error(\"Error: \", error);\r\n                    alert(error)\r\n                });\r\n        } else {\r\n            await categoryRef\r\n                .add(preparedData)\r\n                .then(() => console.log(\"New record has been added.\"))\r\n                .catch((error) => {\r\n                    console.error(\"Errror:\", error)\r\n                    alert(error)\r\n                })\r\n        }\r\n        handleCloseForm()\r\n    }\r\n\r\n    const onItemDeleteListener = async (id, list, journals) => {\r\n        if (window.confirm(\"Are you sure?\")) {\r\n            if (journalDatas) {\r\n                journalDatas.forEach(async (x) => {\r\n                    console.log('data id', list.id);\r\n                    console.log('cate id', x.category.id)\r\n                    if (x.category.id === list.id) {\r\n                        const temp2 = x;\r\n                        console.log('journalRef', journalRef);\r\n                        temp2.category.id = \"unknown\";\r\n                        temp2.category.name = \"Uncategorised\";\r\n                        await journalRef.doc(x.id)\r\n                            .set(temp2)\r\n                            .then(() => console.log(\"moneyRef has been set\"))\r\n                            .catch((error) => {\r\n                                console.error(\"Error: \", error);\r\n                                alert(error)\r\n                            });\r\n                    }\r\n                })\r\n            }\r\n            await categoryRef.doc(id).delete()\r\n        }\r\n    }\r\n\r\n    const handleEditClick = (id, list) => {\r\n        let preparedData = {\r\n            id: id,\r\n            description: list.description,\r\n            name: list.name,\r\n            createdAt: new Date(list.createdAt.seconds)\r\n        }\r\n        console.log(\"handleEditClick\", preparedData)\r\n        setTempData(preparedData)\r\n        setEditMode(true)\r\n        setShowForm(true)\r\n    }\r\n\r\n    const handleshowForm = () => setShowForm(true)\r\n    const handleCloseForm = () => { setShowForm(false) }\r\n\r\n    return (\r\n        <div style={{ \"marginTop\": 1 + '%' }}>\r\n            <Container>\r\n                <Row>\r\n                    <Col>\r\n                        <h1 >Category Management</h1>\r\n                        <Button variant=\"outline-dark\" onClick={handleshowForm}>\r\n                            <BsPlus /> Add\r\n                </Button>\r\n                    </Col>\r\n                </Row>\r\n                <div style={{ \"marginTop\": 3 + '%' }}>\r\n                    <Table stickyheader=\"true\" aria-label=\"sticky table\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>#</th>\r\n                                <th>Name</th>\r\n                                <th>Description</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {categoryState}\r\n                        </tbody>\r\n                    </Table>\r\n                </div>\r\n\r\n                <Modal\r\n                    show={showForm} onHide={handleCloseForm}\r\n                    aria-labelledby=\"contained-modal-title-vcenter\"\r\n                    centered>\r\n                    <form onSubmit={handleSubmit(onSubmit)}>\r\n                        <input\r\n                            type=\"hidden\"\r\n                            placeholder=\"createdAt\"\r\n                            ref={register({ required: false })}\r\n                            name=\"id\"\r\n                            id=\"id\"\r\n                            defaultValue={format(tempData.createdAt, \"yyyy-MM-dd\")}\r\n                        />\r\n                        <input\r\n                            type=\"hidden\"\r\n                            placeholder=\"ID\"\r\n                            ref={register({ required: false })}\r\n                            name=\"id\"\r\n                            id=\"id\"\r\n                            defaultValue={tempData.id}\r\n                        />\r\n                        <Modal.Header closeButton>\r\n                            <Modal.Title>\r\n                                {editMode ? \"Edit Category\" : \"Add New Category\"}\r\n                            </Modal.Title>\r\n                        </Modal.Header>\r\n                        <Modal.Body>\r\n                            <Row>\r\n                                <Col>\r\n                                    <label htmlFor=\"name\">Name</label>\r\n                                </Col>\r\n                                <Col>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Name\"\r\n                                        ref={register({ required: true })}\r\n                                        name=\"name\"\r\n                                        id=\"name\"\r\n                                        defaultValue={tempData.name}\r\n                                    />\r\n                                </Col>\r\n                            </Row>\r\n                            <Row>\r\n                                <Col>\r\n                                    <label htmlFor=\"name\">Description</label>\r\n                                </Col>\r\n                                <Col>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Description\"\r\n                                        ref={register({ required: true })}\r\n                                        name=\"description\"\r\n                                        id=\"description\"\r\n                                        defaultValue={tempData.description}\r\n                                    />\r\n                                </Col>\r\n                            </Row>\r\n                        </Modal.Body>\r\n                        <Modal.Footer>\r\n                            <Button variant=\"secondary\" onClick={handleCloseForm}>\r\n                                Close\r\n                        </Button>\r\n                            <Button variant={editMode ? \"success\" : \"primary\"} type=\"submit\">\r\n                                {editMode ? \"Save Category\" : \"Add Category\"}\r\n                            </Button>\r\n                        </Modal.Footer>\r\n                    </form>\r\n                </Modal>\r\n            </Container>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction CategoryTableRow(props) {\r\n    let data = props.data\r\n    let id = props.id\r\n    let list = props.list\r\n    console.log(`props ${data}`)\r\n    return (\r\n        <tr>\r\n            <td>\r\n                <BsTrash onClick={() => props.onDeleteClicked(id, list)} />\r\n                <BsPencil onClick={() => props.onEditClick(id, list)} />\r\n            </td>\r\n            <td>{data.name}</td>\r\n            <td>{data.description}</td>\r\n        </tr>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}